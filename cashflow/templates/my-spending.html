{% extends 'base.html' %}

{% block content %}
{% load static %}
<style>
    body{
        background-color: whitesmoke;
        font-family: "Helvetica";
    }
    h1{
        font-weight: 700;
        /* identical to box height */

        text-align: center;

        color: #28362F;
    }
    h5{
        color: #28362F;
        text-align: center;
    }
    .choices-img{
        border-radius: 20px;
        height: 90px;
        box-shadow: 0px 10px 22px 8px rgba(0, 0, 0, 0.11);
    }


</style>
<script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      
    <script type="text/javascript" language="javascript">
    $(document).ready(function(){
        $.get("/cashflow/json/income", function(incomes) {
            console.log(incomes);
            for (i = 0; i < incomes.length; i++){
                $(".income").append(`<tr>
                            <th scope="row">${i+1}</th>
                            <td>${incomes[i].fields.date}</td>
                            <td>${incomes[i].fields.name}</td>
                            <td>${incomes[i].fields.income_type}</td>
                            <td>${incomes[i].fields.amount}</td>
                            <td><button class="btn btn-danger" onclick = "deleteIncome(${incomes[i].pk})">X</button></td>
                            </tr>`)
                
            }
        });
        $("#submit").click(function(){
          $.post("/cashflow/add-income/", {
            name : $('#name').val(),
            amount: $('#amount').val(),
            income_type: $( "#income-type option:selected" ).text()},
            function(new_income) {
            console.log(new_income);
            $(".income").append(`<tr>
                            <th scope="row">${i+1}</th>
                            <td>${new_income.fields.date}</td>
                            <td>${new_income.fields.name}</td>
                            <td>${new_income.fields.income_type}</td>
                            <td>${new_income.fields.amount}</td>
                            <td><button class="btn btn-danger" onclick = "deleteIncome(${new_income.pk})">X</button></td>
                            </tr>`) 
        }
            )
          })

        deleteIncome = (id) => {
        $.ajax({
          url: `/cashflow/delete-income/${id}`,
          type: 'DELETE',
          success: function(response){
            $(`#${id}--task`).remove()
            window.location.reload()
          }
        })
      }
        // function deleteIncome(id){
        //     $.ajax({
        //         url: "/cashflow/json/income/"+id,
        //         method: 'DELETE',
        //         success: function(){
        //             alert('success')
        //         },
        //         error: function(error){
        //             alert(error)
        //         }
                
        //     })
        // }
    }); 
    </script>
</head>

<body>
    <div class="container-fluid ">
        <div class="container" style="margin-top:5%">
            <div class="row justify-content-center">
                <h1>My Spending</h1>
            </div>
            <div class="row justify-content-center">
                <div class="container overflow-auto" style="height: 350px;box-shadow: 0px 10px 22px 8px rgba(0, 0, 0, 0.11);">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                            <th scope="col">No</th>
                            <th scope="col">Date</th>
                            <th scope="col">Name</th>
                            <th scope="col">Type</th>
                            <th scope="col">Amount</th>
                            <th scope="col">Delete</th>
                            </tr>
                        </thead>
                        <tbody class="income">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row justify-content-center" style="margin-top: 20px;">
                <h5>Add new:</h5>
            </div>
            <div class="row justify-content-center row-cols-3">
                <div class="col-1">
                    <a href="#"data-bs-toggle="modal" data-bs-target="#salaryModal">
                        <img class="choices-img" src="{% static 'img/salary.png' %}" >
                    </a>
                </div>
                <div class="col-1">
                    <a href="#"data-bs-toggle="modal" data-bs-target="#salaryModal">
                        <img class="choices-img" src="{% static 'img/passive.png' %}" >
                    </a>
                </div>
                <div class="col-1">
                    <a href="#"data-bs-toggle="modal" data-bs-target="#salaryModal">
                        <img class="choices-img" src="{% static 'img/others.png' %}" >
                    </a>
                </div>
            </div>
            <div class="row justify-content-center" style="margin-top: 20px;">
                <a class="btn btn-primary" href="{% url 'cashflow:show_cashflow'%}" style="width: 100px ;">Back</a>
            </div>

        </div>
    </div>

    <!-- Modal -->
  <div class="modal fade" id="salaryModal" tabindex="-1" aria-labelledby="salaryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="salaryModalLabel">Add New Income</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form method="POST" action="">
                {% csrf_token %}
                <table>
                    <tr>
                        <td>Name: </td>
                        <td><input type="text" name="title" placeholder="Income name.." class="form-control" id="name"></td>
                    </tr>
                            
                    <tr>
                        <td>Amount: </td>
                        <td><input type="text" name="description" placeholder="Amount.." class="form-control" id="amount"></td>
                    </tr>
                    <tr>
                        <td>Type: </td>
                        <td><select class="form-select" id="income-type" aria-label="Default select example">
                            <option value="1">Salary</option>
                            <option value="2">Passive</option>
                            <option value="3">Others</option>
                          </select></td>
                    </tr>
                    
                </table>

              </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" id="submit" data-bs-dismiss="modal" class="btn btn-success">Add</button>
        </div>
      </div>
    </div>
  </div>

  
</body>


{% endblock content %}